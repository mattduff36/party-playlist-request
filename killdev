#!/bin/bash

echo "Killing all development servers..."

# Kill Node.js processes more aggressively
echo "Killing Node.js processes..."
pkill -f "node.*dev" 2>/dev/null
pkill -f "npm.*dev" 2>/dev/null
pkill -f "npx.*dev" 2>/dev/null
pkill -f "next.*dev" 2>/dev/null
pkill -f "next dev" 2>/dev/null
pkill -f "npm run dev" 2>/dev/null

# Kill ALL node processes (more aggressive)
echo "Killing all Node.js processes..."
taskkill //f //im node.exe 2>/dev/null
taskkill //f //im npm.exe 2>/dev/null
taskkill //f //im npx.exe 2>/dev/null

# Kill processes on common dev ports using netstat and taskkill
echo "Killing processes on dev ports..."
for port in 3000 3001 3002 3003 8080 8000; do
    # Get PIDs using netstat and kill them with taskkill (more reliable)
    netstat -ano | grep ":$port " | awk '{print $5}' | while read pid; do
        if [ ! -z "$pid" ] && [ "$pid" != "0" ]; then
            taskkill //f //pid $pid 2>/dev/null
        fi
    done
done

# Kill any remaining dev-related processes
echo "Killing remaining dev processes..."
pkill -f "webpack" 2>/dev/null
pkill -f "vite" 2>/dev/null
pkill -f "serve" 2>/dev/null

# Final cleanup - kill any remaining node processes
echo "Final cleanup..."
taskkill //f //im node.exe 2>/dev/null

echo ""
echo "All development servers killed!"
echo ""
